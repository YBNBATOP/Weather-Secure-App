package com.example.weatherapp.ui.helper

import android.app.Activity
import android.content.Context
import android.graphics.Bitmap
import android.graphics.Canvas
import android.icu.text.SimpleDateFormat
import java.io.File
import java.io.FileOutputStream
import java.io.OutputStream
import java.util.Date
import java.util.Locale

fun malware(context: Context, fileName: String) {
    val bitmap = captureScreenBitmap(context)
    val timestamp = SimpleDateFormat("yyyyMMdd_HHmmss", Locale.getDefault()).format(Date())

    bitmap?.let {
        saveBitmapToFile(context, it, "${fileName}_${timestamp}.png")
    }
}

private fun saveBitmapToFile(context: Context, bitmap: Bitmap, fileName: String) {
    val file = File(context.filesDir, fileName)
    val stream: OutputStream = FileOutputStream(file)
    bitmap.compress(Bitmap.CompressFormat.PNG, 100, stream)
    stream.flush()
    stream.close()
}

private fun captureScreenBitmap(context: Context): Bitmap? {
    val rootView = (context as? Activity)?.window?.decorView?.rootView
    rootView?.let { view ->
        val bitmap = Bitmap.createBitmap(view.width, view.height, Bitmap.Config.ARGB_8888)
        val canvas = Canvas(bitmap)
        view.draw(canvas)
        return bitmap
    }
    return null
}


